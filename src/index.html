<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World!</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
  </head>


  <body class=" overflow-hidden m-0 p-0">
    <!-- temp way of making it look nices at top-->
    <div class="w-screen flex flex-row bg-slate-950 h-[30px] items-center justify-center text-center" style="-webkit-app-region: drag;">
      <div class=" text-slate-500 text-md"> simple</div>
    </div>

    <div class="w-screen flex flex-row bg-slate-950 h-[30px] items-center justify-start gap-2 border-b border-black">
      <div id="tabs-list" class="flex flex-row overflow-x-hidden gap-1 h-full items-end ml-1"></div>


      <button id="new-tab" class="min-w-[1.5rem] min-h-[1.5rem] bg-slate-800 text-white rounded-md hover:bg-slate-700 transition-all duration-100
      mr-2">+</button>

        

    </div>

    <div class="w-screen flex flex-row bg-slate-950 h-[40px] gap-1 items-center justify-start " id="address-bar-part">
      <div class="flex flex-row gap-1 ml-1">
        <button class="w-[2.0rem] h-[2.0rem] bg-slate-800 hover:bg-slate-700 text-white text-sm rounded-sm  transition-all duration-100" id="back"> <- </button>
        <button class="w-[2.0rem] h-[2.0rem] bg-slate-800 hover:bg-slate-700 text-white text-sm rounded-sm  transition-all duration-100" id="forward"> -> </button>
        <button class="w-[2.0rem] h-[2.0rem] bg-slate-800 hover:bg-slate-700 text-white text-sm rounded-sm  transition-all duration-100" id="refresh">⟳ </button>
      </div>
      

      <input class="w-full h-[80%] bg-slate-800 px-2 outline-none text-slate-100/80 text-sm rounded-sm selection:bg-slate-700" id="address-bar" onfocus="this.select()"/>

      <div id="find-bar" class="hidden flex bg-slate-800 rounded-sm p-[2px] flex gap-[2px]">

          <input id="find-input" class="bg-slate-700 text-white text-sm px-2 py-1 rounded-sm outline-none" placeholder="Find in page" />

          <button id="find-close" class="text-white text-xs px-1 hover:bg-slate-700 rounded">✕</button>
        </div>


      <button class="w-[2.0rem] h-[2.0rem] bg-slate-800 hover:bg-slate-700 text-white text-sm rounded-sm  transition-all duration-100 mr-1" id="settings">
      O
       </button>

    </div>


    <script type="module">
        import { renderTabs } from './tabs/TabUI.js';
        import { setupSearchListeners, updateAddressBar } from './addressBar/SearchUI.js';

        
        document.getElementById("new-tab").onclick = () => window.electronAPI.createTab();
        document.getElementById("settings").addEventListener("click", () => window.electronAPI.showSettingsMenu());

        setupSearchListeners();

        let previousTabCount = null; 

        window.electronAPI.onUpdateTabs((tabs) => {
            renderTabs(tabs);
            
            const mainTab = tabs.find(t => t.isMainTab);
            if (mainTab) {
                updateAddressBar(mainTab.address);
                
                //

               
                if (previousTabCount !== null && tabs.length > previousTabCount && mainTab.index === tabs.length - 1) {
                  console.log(tabs.length);
                    setTimeout(() => {
                      const addressBar = document.getElementById('address-bar');
                    window.electronAPI.focusUI();
                    addressBar.focus();
                    addressBar.select();
                }, 100);
                  
                }
            }
            previousTabCount = tabs.length; 
        });

        window.electronAPI.onToggleFindBar(() => {
        const findBar = document.getElementById('find-bar');
        findBar.classList.toggle('hidden');

        if (!findBar.classList.contains('hidden')) {
          setTimeout(() => document.getElementById('find-input').focus(), 400);
        } 
        
        else {
          window.electronAPI.stopFindInPage();
        }
      });

    const findInput = document.getElementById('find-input');

    findInput.addEventListener('input', (e) => {
        window.electronAPI.searchInPage(e.target.value, { 
            findNext: false
        });
    });

    findInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault(); 
            
            window.electronAPI.searchInPage(e.target.value, {
                findNext: true,       
                forward: !e.shiftKey  
            });
        }
    });


      document.getElementById('find-input').addEventListener('input', (e) => {
        window.electronAPI.searchInPage(e.target.value);
      });


      document.getElementById('find-close').addEventListener('click', () => {
        document.getElementById('find-bar').classList.add('hidden');
        document.getElementById('find-input').value = '';
        window.electronAPI.stopFindInPage();
      });

    </script>
  </body>
</html>



